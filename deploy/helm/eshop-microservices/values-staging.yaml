# Staging environment overrides for eshop-staging namespace

global:
  namespace: eshop-staging
  environment: staging
  imageTag: latest
  imageRegistry: de.icr.io/eshop-images
  imagePullPolicy: IfNotPresent

# Medium replica counts for staging
replicaCount:
  catalogApi: 2
  basketApi: 2
  orderingApi: 2
  discountGrpc: 1
  yarpGateway: 2
  shoppingWeb: 1
  healthdeckWeb: 1

# Medium resources for staging
resources:
  catalogApi:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  basketApi:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  orderingApi:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  discountGrpc:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi
  yarpGateway:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  shoppingWeb:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi
  healthdeckWeb:
    requests:
      cpu: 25m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Medium storage for staging
postgresql:
  catalogDb:
    storageSize: 10Gi
    storageClass: ibmc-vpc-block-10iops-tier
  basketDb:
    storageSize: 10Gi
    storageClass: ibmc-vpc-block-10iops-tier

sqlserver:
  storageSize: 20Gi
  storageClass: ibmc-vpc-block-10iops-tier
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi

redis:
  storageSize: 2Gi
  storageClass: ibmc-vpc-block-10iops-tier

rabbitmq:
  storageSize: 5Gi
  storageClass: ibmc-vpc-block-10iops-tier

elasticsearch:
  storageSize: 20Gi
  storageClass: ibmc-vpc-block-10iops-tier
  javaOpts: "-Xms512m -Xmx512m"

# Staging ingress - Subdomain-based routing
ingress:
  enabled: true
  hosts:
    # Shopping Web UI
    - host: eshop-staging.lgharbi-eshop-cluster-k8s-8a833d5c3d6a9b7ed1b32c0af11fc140-0000.eu-de.containers.appdomain.cloud
      paths:
        - path: /
          pathType: Prefix
          service: shopping-web
          port: 80
    # API Gateway (YARP)
    - host: api-staging.lgharbi-eshop-cluster-k8s-8a833d5c3d6a9b7ed1b32c0af11fc140-0000.eu-de.containers.appdomain.cloud
      paths:
        - path: /
          pathType: Prefix
          service: yarp-gateway
          port: 80
    # Health Dashboard
    - host: health-staging.lgharbi-eshop-cluster-k8s-8a833d5c3d6a9b7ed1b32c0af11fc140-0000.eu-de.containers.appdomain.cloud
      paths:
        - path: /
          pathType: Prefix
          service: healthdeck-web
          port: 80
    # Kibana (Logs Dashboard)
    - host: kibana-staging.lgharbi-eshop-cluster-k8s-8a833d5c3d6a9b7ed1b32c0af11fc140-0000.eu-de.containers.appdomain.cloud
      paths:
        - path: /
          pathType: Prefix
          service: kibana
          port: 5601
  tls:
    enabled: true
    secretName: eshop-staging-tls

# Enable autoscaling in staging
autoscaling:
  enabled: true
  catalogApi:
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70
  basketApi:
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70
  orderingApi:
    minReplicas: 2
    maxReplicas: 4
    targetCPUUtilizationPercentage: 70
  yarpGateway:
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Enable network policies in staging
networkPolicies:
  enabled: true

# Enable PDB in staging
podDisruptionBudget:
  enabled: true
  minAvailable: 1
